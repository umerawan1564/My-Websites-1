var tdsLeads={};
(function(){tdsLeads={items:[],init:function(){tdsLeads.items=[]},item:function(){this.jqueryObj=this.blockUid=void 0;this.showCaptcha=!1;this.captchaSiteKey="";this.acknowledgementCheckboxShow=!0;this.acknowledgementCheckboxMsg='I\'ve read and accept the <a href="#">Privacy Policy</a>.';this.subscribeBtnTxt="Subscribe";this.unSubscribeBtnTxt="Unsubscribe";this.unSubscribedRdrURL=this.subscribedRdrURL="";this.submitHasErrors=this.isSubmit=this.inComposer=this.ajaxSubmit=!1;this.messages={ack_require:"",
captcha_user_score:"",captcha_failed:"",success_subscribe:"",success_unsubscribe:"",input_placeholder:"",unsubscribe_msg:""};this._is_initialized=!1},_initialize_item:function(a){if(!0!==a._is_initialized){var c="g-recaptcha-response-leads-"+a.blockUid,b=jQuery("#"+c);if("show"===tdUtil.getBackendVar("tds_captcha")&&1===b.length){var h=b.attr("data-sitekey");grecaptcha.ready(function(){grecaptcha.execute(h,{action:"validate_captcha"}).then(function(a){document.getElementById(c).value=a})})}a.jqueryObj.on("click",
".tds-submit-btn",function(b){var n=jQuery(this),c=n.data("url"),f=a.jqueryObj.find(".tds-checkbox"),e=a.jqueryObj.find(".tds-messages-error"),k=a.jqueryObj.find(".tds-form"),m=k.find(".tds-input-wrap"),l=!1,p=a.jqueryObj.find(".tds-info");f.length&&(f=a.jqueryObj.find("#pp_checkbox_"+a.blockUid),f.length&&!f.is(":checked")&&(b.preventDefault(),l=!0,e.length?e.find(".tds-message-checkbox").length||e.append('<div class="tds-message tds-message-checkbox">'+a.messages.ack_require+"</div>"):a.jqueryObj.find(".tds-info").prepend('<div class="tds-messages tds-messages-error"><div class="tds-message tds-message-checkbox">'+
a.messages.ack_require+"</div></div>"),setTimeout(function(){var b=jQuery("."+a.blockUid+" .tds-messages");b.length&&(b.addClass("tds-messages-hiding"),setTimeout(function(){b.remove()},300))},3E3)));if(!l){if(a.ajaxSubmit){b.preventDefault();k.addClass("tds-s-content-loading");l=0!==a.jqueryObj.find('input[name="subscribed"]').length;e=a.jqueryObj.find('input[name="list"]');var q=parseInt(e.val());e=a.jqueryObj.find('input[name="rdr_url"]');e={list:q,rdr_url:e.val()};if(l)e.action="unsubscribe";
else{l=a.jqueryObj.find('input[name="email"]');f=a.jqueryObj.find('input[name="double_opt_in"]');var r=a.jqueryObj.find('input[name="g-recaptcha-response"]');Object.assign(e,{email:l.val(),double_opt_in:f.val(),recaptcha_response:r.length?r.val():"",action:"subscribe"})}jQuery.ajax({timeout:1E4,type:"POST",url:tdsLeads.get_rest_endpoint("tds_leads/tds_leads_form_submit","uuid="+tdsLeads.get_unique_id()),beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",window.tds_js_globals.wpRestNonce)},cache:!0,
data:e,dataType:"json",statusCode:{404:function(){console.log("tds leads - ERROR: 404 not found")},500:function(){console.log("tds leads - ERROR: 500 server error")}},success:function(b){var c=b.errors;b=b.result;if(0<Object.keys(c).length){console.log("hi");var d='<div class="tds-messages tds-messages-error">';Object.values(c).map(function(a){d+='<div class="tds-message">'+a+"</div>"});d+="</div>";p.append(d)}else b.hasOwnProperty("new_lead_data")?b.new_lead_data.tds_list_id===q&&(p.append('<div class="tds-messages tds-messages-success"><div class="tds-message">'+
a.messages.success_subscribe+"</div></div>"),k.prepend('<input type="hidden" name="subscribed" value="1">'),m.html('<div class="tds-input-wrap"><div class="tds-unsubscribe-txt">'+tdUtil.b64DecodeUnicode(a.messages.unsubscribe_msg)+"</div></div>"),n.text(a.unSubscribeBtnTxt),k.find(".tds-checkbox").remove(),""!==a.subscribedRdrURL&&window.location.replace(a.subscribedRdrURL)):b.hasOwnProperty("unsubscribed")&&(p.append('<div class="tds-messages tds-messages-success"><div class="tds-message">'+a.messages.success_unsubscribe+
"</div></div>"),k.find('input[name="subscribed"]').remove(),m.html('<input class="tds-input" type="email" name="email" aria-label="email" placeholder="'+a.messages.input_placeholder+'" required>'),a.showCaptcha&&""!==a.captchaSiteKey&&(m.prepend('<input type="hidden" id="g-recaptcha-response-leads-'+a.blockUid+'" name="g-recaptcha-response" data-sitekey="'+a.captchaSiteKey+'"><input type="hidden" name="action" value="validate_captcha">'),grecaptcha.ready(function(){grecaptcha.execute(h,{action:"validate_captcha"}).then(function(a){m.find('input[name="g-recaptcha-response"]').val(a)})})),
a.acknowledgementCheckboxShow&&""!==a.acknowledgementCheckboxMsg&&k.append('<div class="tds-checkbox"><input id="pp_checkbox_'+a.blockUid+'" class="" name="" value="Y" type="checkbox"><label class="checkbox subfield" for="pp_checkbox_'+a.blockUid+'"><span class="tds-check"></span><span class="tds-check-title">'+tdUtil.b64DecodeUnicode(a.acknowledgementCheckboxMsg)+"</span></label></div>"),n.text(a.subscribeBtnTxt),""!==a.unSubscribedRdrURL&&window.location.replace(a.unSubscribedRdrURL));var g=a.jqueryObj.find(".tds-messages");
g.length&&setTimeout(function(){g.addClass("tds-messages-hiding");setTimeout(function(){g.remove()},300)},3E3);k.removeClass("tds-s-content-loading")}})}"undefined"!==typeof c&&(b.preventDefault(),window.location.replace(c))}});a.jqueryObj.find("#pp_checkbox_"+a.blockUid).change(function(){var b=jQuery(this),h=a.jqueryObj.find(".tds-messages-error"),c=h.find(".tds-message-checkbox");b.is(":checked")&&(c.remove(),h.is(":empty")&&h.remove())});a._is_initialized=!0}},addItem:function(a){if("undefined"===
typeof a.blockUid)throw"item.blockUid is not defined";tdsLeads.items.push(a);tdsLeads._initialize_item(a)},deleteItem:function(a){for(var c=0;c<tdsLeads.items.length;c++)if(tdsLeads.items[c].blockUid===a)return tdsLeads.items.splice(c,1),!0;return!1},get_rest_endpoint:function(a,c){return _.isEmpty(window.tds_js_globals.permalinkStructure)?window.tds_js_globals.wpRestUrl+a+"&"+c:window.tds_js_globals.wpRestUrl+a+"?"+c},get_unique_id:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}
return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}})();jQuery().ready(function(){tdsLeads.init()});var tdsStore;
(function(a,c,b){tdsStore={_db:b,_dbName:b,_dbStoreName:b,_indexedDB:b,_isInitialized:!1,init:function(a,b){tdsStore._isInitialized||(tdsStore._indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,tdsStore._indexedDB?(tdsStore._dbName=a,tdsStore._dbStoreName=b):console.log("Your browser doesn't support a stable version of IndexedDB!"),tdsStore._isInitialized=!0)},openDb:function(){if(tdsStore._isInitialized){var a=tdsStore._indexedDB.open(tdsStore._dbName);a.onsuccess=
function(a){tdsStore._db=this.result};a.onupgradeneeded=function(a){a.currentTarget.result.createObjectStore(tdsStore._dbStoreName,{keyPath:"id"})}}},getObjectStore:function(a,b){if(tdsStore._isInitialized)return tdsStore._db.transaction(a,b).objectStore(a)},add:function(a,b){if(tdsStore._isInitialized){a={id:a,content:b};b=tdsStore.getObjectStore(tdsStore._dbStoreName,"readwrite");try{var c=b.put(a)}catch(d){throw console.log(d.name),d;}c.onsuccess=function(a){};c.onerror=function(){}}},get:function(b){var c=
a.Deferred(),h=tdsStore.getObjectStore(tdsStore._dbStoreName,"readwrite");try{var d=h.get(b)}catch(f){throw console.log(f.name),f;}d.onsuccess=function(a){c.resolve(this)};d.onerror=function(){};return c}};tdsStore.init("Leads","Cache");tdsStore.openDb()})(jQuery,_);var tdsMain={};
(function(){tdsMain={init:function(){jQuery("body").on("click",".tds-choose-plan-type",function(a){a.preventDefault();a=jQuery(this);var b=a.data("type");"undefined"!==typeof b&&(a=a.data("url-"+b),"undefined"!==typeof a&&(window.location=a))}).on("click",".tds-switcher",function(){tdsMain.setActivePlan(jQuery(this).val())}).on("click",".tds-choose-plan-type-free",function(a){a.preventDefault();a=jQuery(this);var b=a.data("type");"undefined"!==typeof b&&(a=a.data("url-"+b),"undefined"!==typeof a&&
(window.location=a))}).on("click",".tds-s-table-col-expand",function(a){a=jQuery(this);var b=a.find(".tds-s-table-col-label"),c=a.closest(".tds-s-table-row"),g=c.nextAll(".tds-s-table-row-extra-wrap-info:first");c.length&&g.length&&(b.text(b.text()===window.tds_show_more_info?window.tds_show_less_info:window.tds_show_more_info),a.attr("title",a.attr("title")===window.tds_show_more_info?window.tds_show_less_info:window.tds_show_more_info),c.toggleClass("tds-s-table-row-info-expanded"),c.toggleClass("tds-s-table-row-active"),
g.toggle())}).on("click",".tds-resend-activation-link",function(a){var b=jQuery(this),c=b.siblings(".tds-s-notif-descr"),g=b.siblings(".tds-s-notif-js").text();a=b.data("user");"undefined"!==typeof a&&(b.addClass("tds-s-btn-saving"),jQuery.ajax({type:"POST",url:td_ajax_url,data:{action:"td_resend_subscription_activation_link",user:a},success:function(a,h,e){a=jQuery.parseJSON(a);switch(a[0]){case "resend_activation_link":b.next(".tds-info").show().html(a[2]),1===a[1]?(b.addClass("tds-s-btn-saved"),
c.text(g)):b.removeClass("tds-s-btn-saving")}},error:function(a,b,c){}}))});var a=jQuery(".tds-switcher:checked"),c="year";a.length&&(c=a.val());tdsMain.setActivePlan(c)},setActivePlan:function(a){var c=jQuery(".tds-choose-plan-type").not(".tds-switcher-change"),b=jQuery(".tds_plans_price, .tds_plans_description");c.each(function(b,c){b=jQuery(c);b.data("type",a);"undefined"===typeof b.data("url-"+a)?b.attr("disabled",!0):b.removeAttr("disabled")});b.each(function(b,c){b=jQuery(c);c=b.data("type-from-block");
var g=b.find('[class*="tds-show-plan-"]'),d=b.find(".tds-plan-placeholder"),f=a,e=!1;"undefined"!==typeof c&&""!==c&&"free"!==c&&(f=c);g.length?(g.each(function(a,b){a=jQuery(b);b=a.data("type");"undefined"!==typeof b&&b===f?(a.hasClass("tds-show-plan-visible")||a.addClass("tds-show-plan-visible"),window.location!==window.parent.location&&d.hasClass("tds-plan-placeholder-visible")&&d.removeClass("tds-plan-placeholder-visible"),e=!0):a.removeClass("tds-show-plan-visible")}),!1===e&&window.location!==
window.parent.location&&(d.hasClass("tds-plan-placeholder-visible")||d.addClass("tds-plan-placeholder-visible"))):"free"!==c&&(window.location!==window.parent.location?d.hasClass("tds-plan-placeholder-visible")||d.addClass("tds-plan-placeholder-visible"):b.remove())})},b64EncodeUnicode:function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))},b64DecodeUnicode:function(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+
("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))},setStorageItem:function(a,c){tdsStore.add(a,c)},getStorageItem:function(a){return tdsStore.get(a)},setLocalStorageItem:function(a,c){var b=tdsMain._getStorage();b=null===b?{}:JSON.parse(tdsMain.b64DecodeUnicode(b));b[a]=c;tdsMain._setStorage(tdsMain.b64EncodeUnicode(JSON.stringify(b)))},getLocalStorageItem:function(a){var c=tdsMain._getStorage();if(null!==c)try{if(c=JSON.parse(tdsMain.b64DecodeUnicode(c)),c.hasOwnProperty(a))return c[a]}catch(b){}},
clearItem:function(){},_getStorage:function(){return window.localStorage.getItem(window.tdcAdminSettings.themeName)},_setStorage:function(a){window.localStorage.setItem(window.tdcAdminSettings.themeName,a)}}})();jQuery().ready(function(){tdsMain.init()});
